{% extends 'core/base.html' %}

{% block scripts %}
    <script type="text/javascript">
        $(function () {
            Highcharts.chart('payment-by-category', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: 'Spending by Category'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.y:.2f}</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.y:.2f} %',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                },
                series: [{
                    name: 'Categories',
                    colorByPoint: true,
                    data: {{ payments_by_category|safe }}
                }]
            });
        });
    </script>
{% endblock %}

{% block content %}
    <h2>Contribution Statistics</h2>
    <div class="table-container">
        <table>
            <tbody>
                <tr><th>Mean</th><td>${{ contribution_mean }}</td></tr>
                <tr><th>Contributors</th><td>{{ deviations|length }}</td></tr>
            </tbody>
        </table>
    </div>

    <h2>Payment Statistics</h2>
    <div class="table-container">
        <table>
            <tbody>
                <tr><th>Mean</th><td>${{ payment_mean }}</td></tr>
                <tr><th>Total</th><td>${{ total }}</td></tr>
                <tr><th>Number</th><td>{{ number }}</td></tr>
            </tbody>
        </table>
    </div>
    <div id="payment-by-category"></div>

    <h2>Deviations</h2>
    <div class="table-container">
        <table>
            <tbody>
                {% for deviation in deviations %}
                    <tr>
                        <th>{{ deviation.0 }}</th>
                        <td><span class="{{ deviation.1.signal }}">${{ deviation.1.amount }}</span></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
